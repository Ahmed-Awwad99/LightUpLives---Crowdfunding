{% extends "base.html" %}
{% block title %}{{ project.title }}{% endblock %}
{% block content %}
<h1>{{ project.title }}</h1>
<p>{{ project.description }}</p>
<p>Category: {{ project.category.name }}</p>
<p>Target: {{ project.target }} EGP</p>
<p>Total Donated: {{ total_donated }} EGP</p>
<p>Remaining: {{ project.target|floatformat:2|add:"-"|add:total_donated }} EGP</p>

<div id="project-slider" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
        {% for image in project.images.all %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <img src="{{ image.image.url }}" class="d-block w-100" alt="Project Image">
        </div>
        {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#project-slider" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#project-slider" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

{% if user.is_authenticated %}
    <a href="{% url 'report_project' project.id %}" class="btn btn-danger">Report Project</a>
{% endif %}

<h2>Donate to this project</h2>
<form method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" name="donate" class="btn btn-success" >Donate</button>
</form>

<h2>Donations</h2>
<ul>
    {% for donation in donations %}
        <li>{{ donation.donor.email }} donated {{ donation.amount }} EGP on {{ donation.donated_at }}</li>
    {% endfor %}
</ul>

<h2>Comments</h2>
<ul>
    {% for comment in comments %}
        <li>
            <strong>{{ comment.user.email }}</strong> ({{ comment.created_at|date:"d M Y H:i" }}): 
            {{ comment.content }}
        </li>
    {% endfor %}
</ul>

{% if user.is_authenticated %}
    <h3>Add a Comment</h3>
    <form method="POST">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" name="comment" class="btn btn-success">Post Comment</button>
    </form>
{% else %}
    <p><a href="{% url 'sign_in' %}">Sign in</a> to add a comment.</p>
{% endif %}
{% endblock %}
